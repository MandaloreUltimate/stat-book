\section{Критерии согласия Колмогорова и \texorpdfstring{$\chi^{2}$}{хи-квадрат}}

Пусть для наблюдаемого распределения $\MyPr{\xi}$ дана выборка $X_1, \ldots, X_n$, 
проверяется \textit{гипотеза о виде распределения} $H_{0}\colon F_{\xi}=F_{0}$, где $F_{0}$ известна; 
альтернатива $H_{1}: F_{\xi} \neq F_{0}$.

\subsubsection{Критерий согласия $\chi^{2}$ Пирсона}
Разобьём числовую ось на $k$ промежутков ${-\infty=a_{0}<a_{1}<\ldots<a_{k}=\infty}$, ${\Delta_{i}=\left(a_{i-1}, a_{i}\right]}$ и построим статистику $\overline{\chi}^{2}$:
\begin{equation*}
    \overline{\chi}^{2}(\SampleX) = 
    \sum\limits_{i=1}^{k} \frac{\left(\text{наблюдаемое} - \text{ожидаемое}\right)^{2}}{\text{ожидаемое}} = 
    \sum\limits_{i=1}^{k} \frac{\left(n_{i}-n p_{i}^{(0)}\right)^{2}}{n p_{i}^{(0)}},
\end{equation*}
где $n_i$~--- число зафиксированных наблюдений в $i$-м интервале,
${p_{i}^{(0)}=F_{0}\left(a_{i}\right)-F_{0}\left(a_{i-1}\right)}$~--- вероятность попадания наблюдения в $i$-й~интервал при выполнении гипотезы $H_0$, 
$n p_{i}^{(0)}$, соответственно, ожидаемое число попаданий в $i$-й интервал.

\bigskip
\noindent \textbf{Формулировка критерия для простой гипотезы:}

Рассмотрим простую гипотезу $H_0\colon F_{\xi}(x) = F_0(x)$.
\begin{compactlist}
    \item Если верна гипотеза $H_0$, то $\overline{\chi}^{2}\left(\SampleX\right) \xrightarrow[n \to \infty]{\text{d}} \chi^{2}_{k-1}$, 
    %где $\zeta$ подчиняется распределению $\chi^{2}$ с $k-1$ степенями свободы ($k$~--- число интервалов разбиения);
    где $k$~--- число интервалов разбиения.
    \item Если верна гипотеза $H_1$, то $\overline{\chi}^{2} \xrightarrow[n \to \infty]{\text{п.н.}} \infty$.
\end{compactlist}

Выберем уровень значимости (т.е. вероятность ошибки первого рода) $\alpha \in (0, 1)$. 
Область $(\chi^{2}_{k-1, 1 - \alpha}, \infty)$, где $\chi^{2}_{k-1, 1 - \alpha}$~--- квантиль порядка $1-\alpha$ распределения $\chi^{2}$ с $k-1$ степенями свободы, является критической для гипотезы $H_0$.

Правило проверки гипотез:
\begin{compactlist}
    \item Если $\overline{\chi}^{2} \left(\SampleX\right)>\chi^{2}_{k-1, 1 - \alpha}$, то $H_0$ отклоняется;
    \item Если $\overline{\chi}^{2} \left(\SampleX\right) \leqslant \chi^{2}_{k-1, 1 - \alpha}$, то для отклонения $H_0$ нет оснований.
\end{compactlist}
\medskip
\input{src/figs/fig7}

Фактически критерий $\chi^{2}$ проверяет значимость расхождения эмпирических (наблюдаемых) и теоретических (ожидаемых) частот. 
Рассмотрим его применение на следующем примере.

\begin{exmp}
    При $4040$ бросках монеты математик Бюффон получил $n_1 = 2048$ выпадения "<герба"> и $n_2 = n - n_1 = 1992$ выпадения "<решки">.
    Проверим, согласуются ли данные с гипотезой о том, что монета симметрична, т.е. $H_0 \colon p = 1/2$.
    Мы исследуем бернуллиевскую случайную величину $\xi \sim \Bernoulli_{p} = \Binom_{1, p}$.
    Она принимает лишь значения $0$ и $1$.
    Выберем промежутки $(-0.5, 0.5)$ и $(0.5, 1.5)$ (или любые другие два, содержащие $0$ и $1$ соответственно).
    Согласно предположению, $p = p_1^{(0)} = p_2^{(0)} = 1/2$.
    Подсчитаем значение статистики $\chi^{2}_{\SampleX}$:
    \begin{equation*}
        \sum\limits_{i = 1}^{k} \frac{(n_i - np_i^{(0)})^2}{np_i^{(0)}} = 
        \frac{(n_1 - np)^2}{np} + \frac{(n_2 - np)^2}{np} = 
        \frac{28^2}{2020} + \frac{28^2}{2020} = \frac{784}{1010} \approx 0.776
    \end{equation*}
    Положим уровень значимости $\alpha = 0.05$ и найдём квантиль $\chi^2_{k-1, 1 - \alpha} = \chi^2_{1, 0.95} \approx 3.8415$.
    Сравниваем полученное: $0.776 < 3.8415$.
    Делаем вывод, что данные не противоречат гипотезе.
\end{exmp}

\noindent \textbf{Критерий $\chi^2$ для сложной гипотезы.}

Рассмотрим сложную гипотезу $H_0\colon F_{\xi}(x) \in \SigAlg_{\theta} = \bigl\{ F(x, \theta)\colon \theta \in \Theta\bigr\}$.
Как и в простом случае, сгруппируем данные в $k$ интервалов. 
Теоретические вероятности попадания в интервалы теперь не будут заданы однозначно, а представляют собой некоторые функции от параметра $\theta$.
Поэтому статистика имеет вид 
\begin{equation*}
    \overline{\chi^2} = \sum\limits_{i = 1}^{n} \frac{\left(n_i - n p_{i}^{(0)}(\theta)\right)^2}{n p_{i}^{(0)}(\theta)}
\end{equation*}
Эта статистика зависит от неизвестного параметра; следовательно, непосредственно использовать её для построения критерия пока нельзя~---
требуется сначала исключить неопределённость, связанную с неизвестным параметром $\theta$.
Для этого заменяют $\theta$ некоторый оценкой $\tilde{\theta} = \tilde{\theta}(\SampleX)$ и получают статистику
\begin{equation*}
    \overline{\chi^2} = \sum\limits_{i = 1}^{n} \frac{\left(n_i - n p_{i}^{(0)}(\tilde{\theta}) \right)^2}{n p_{i}^{(0)}(\tilde{\theta})}
\end{equation*}
Но, вообще говоря, теперь $p_{i}^{(0)}(\tilde{\theta})$ являются случайными величинами, и мы не можем утверждать, что распределение статистики $\overline{\chi^2}$ будет стремиться к $\chi^{2}_{k-1}$.
Более того, следует ожидать, что распределение этой статистики (если оно существует) будет зависеть от способа построения оценки $\tilde{\theta}$.

К счастью для нас, английский статистик Рональд Фишер ещё в 1924 году показал, что существуют методы оценивания параметра $\theta$, 
при котором предельное распределение имеет простой вид, а именно является распределением $\chi^{2}_{k - 1 - r}$, где $r$~--- размерность оцениваемого параметра.
Один из таких методов использует мультиномиальную оценку максимального правдоподобия.


\begin{exmp}
    Следующая задача возникла в связи с бомбардировками Лондона во время Второй мировой войны. 
    Для улучшения организации оборонительных мероприятий, необходимо было понять цель противника. 
    Для этого территорию города условно разделили сеткой из 24 горизонтальных и 24 вертикальных линий на 576 равных участков. 
    В течении некоторого времени в центре организации обороны города собиралась информация о количестве попаданий снарядов в каждый из участков. 
    В итоге были получены следующие данные:
    \begin{center}
        \begin{tabular}{|c|c|c|c|c|c|c|c|c|}
        \hline Число попаданий & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 \\
        \hline Количество участков & 229 & 211 & 93 & 35 & 7 & 0 & 0 & 1 \\
        \hline
        \end{tabular}
    \end{center}
    
    %Гипотеза $H_0$: стрельба случайна (нет "<целевых"> участков).
    Сформулируем основную гипотезу: стрельба случайна (нет "<целевых"> участков).
    В таком случае количество попаданий в участок можно описать распределением Пуассона~--- 
    оно моделирует число событий, произошедших за фиксированное время, при условии, что данные события происходят с некоторой фиксированной средней интенсивностью и независимо друг от друга.
    Т.е. $H_0\colon F(x) \sim \Pois_{\lambda}$.\footnote{Пример взят из \textit{Лагутин М.Б.} Наглядная математическая статистика: учебное пособие.~--- 2-е изд., испр.~--- М.: БИНОМ. Лаборатория знаний, 2009.~--- стр. 278.}
    
    Высчитаем теоретические вероятности:
    \begin{equation*}
        p_i^{(0)} = \MyPr\{S=i\}=\frac{\lambda^{i}}{i !} e^{-\lambda},
    \end{equation*}
    где $S$~--- число попаданий, $\lambda \approx 0{,}924$ \textit{(мультиномиальная ОМП)}.
    
    Обозначим за $n_i$ количество участков, на которые пришлось $i$ попаданий, и составим новую таблицу для применения критерия.
    
    \begin{center}
        \begin{tabular}{|c|c|c|c|c|c|c|c|c|}
            \hline $i$ & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 \\
            \hline $n_i$ & 229 & 211 & 93 & 35 & 7 & 0 & 0 & 1 \\
            $n_{i} \cdot p_{i}^{(0)}$ & 226{,}7 & 211{,}4 & 98{,}5 & 30{,}6 & 7{,}14 & 1{,}33 & 0{,}21 & 0{,}03 \\
            \cline { 6 - 9 }$n_{i} \cdot \tilde{p}_{i}^{(0)}$ & 228{,}6 & 211{,}3 & 97{,}6 & 30{,}1 & \multicolumn{4}{|c|} {8{,}46} \\
            \hline
        \end{tabular}
    \end{center}
    
    Прежде чем вычислять статистику $\overline{\chi}^{2}$, мы объединили 4 последних события с низкими частотами в одно (соответственно, $k=5$) 
    и пересчитали новые теоретические вероятности~$\tilde{p}_i^{(0)}$ и, соответственно, новые ожидаемые значения. 
    В этом случае $\overline{\chi}^{2} \approx 1{,}05$. 
    Т.к. $k=5$, то по таблице распределения $\chi^{2}$ находим соответствующий уровень значимости $\alpha = 0{,}79$. 
    Гипотеза о низкой точности стрельбы не отклоняется.
    Посмотрим теперь на квантили распределения $\chi^{2}_{k-1-r} = \chi^{2}_{3}$:
    \begin{center}
        \begin{tabular}{|c|c|c|c|c|c|c|c|c|c|}
            \hline $1 - \alpha$         & 0{,}025 & 0{,}05  & 0{,}1   & 0{,}2   & 0{,3}   & 0{,}5  & 0{,}9  & 0{,}95  & 0{,}99 \\
            \hline Квантиль $\chi^{2}_{3}$ & 0{,}216 & 0{,}352 & 0{,}584 & 1{,}005 & 1{,}424 & 2{,}366 & 6{,}2514 & 7{,}815 & 11{,}345 \\
            \hline
        \end{tabular}
    \end{center}
    Даже если мы выберем $\alpha = 0{,}7$ и будем отвергать верную основную гипотезу с вероятностью $0{,}7$, критерий $\chi^2$ всё равно примёт $H_0$.
    То есть, соответствие гипотезы с наблюдаемыми данными очень хорошее.
    
    Обратим внимание на необходимость объединения маловероятных промежутков: если оставить $k = 8$, то $\overline{\chi}^{2} \approx 32{,}6$, 
    что значительно велико даже на уровне $\alpha = 10^{-5}$. 
    Подобная ошибка критерия $\chi^{2}$ вероятна на всех выборках с низкочастотными событиями. 
    Проблема решается либо отбрасыванием, либо объединением данных событий. %(\textit{коррекция Йетса}).
\end{exmp}
Рекомендуемые условия применения критерия согласия $\chi^2$ Пирсона~--- $n \geqslant 50, n_i \geqslant 5 \; \forall i = \overline{1, k}$.
    
    
\subsubsection{Критерий Колмогорова}
Наложим дополнительное условие на исходную задачу проверки гипотезы $H_0\colon F_{\xi}(x) = F_0(x)$~--- $F_{0}(x) \in C(\Real)$.

Рассмотрим статистику Колмогорова:
\begin{equation*}
    D_{n}\left(\SampleX\right)=\sup\limits_{x \in R}\left|F_{n}^{*}(x)-F_{0}(x)\right|
\end{equation*}

Формулировка критерия:
\begin{compactlist}
    \item Если верна гипотеза $H_0$, то $D_{n}\left(\SampleX\right) \xrightarrow[n \to \infty]{\text{п.н.}} 0$;
    \item Если верна гипотеза $H_1$, т.е. $F_{\xi} \equiv G \neq F_{0}$, то
    \begin{equation*}
        % Дробь из стрелки и текста~--- это шедевр. Не могу удалить.
        % D_{n}\left(\SampleX\right) \frac{\text { п.н. }}{n \to \infty} \sup\limits_{x \in R}\left|G(x)-F_{0}(x)\right|>0
        D_{n}\left(\SampleX\right) \xrightarrow[n \to \infty]{\text{п.н.}} \sup\limits_{x \in R}\left|G(x)-F_{0}(x)\right|>0
    \end{equation*}
\end{compactlist}

\begin{lem}
Если гипотеза $H_0$ верна, и $F_{0}(x) \in C(\Real)$, то распределение статистики $D_{n}=\sup\limits_{x \in R}|F_{n}^{*}(x)-F_{0}(x)|$ не зависит от наблюдаемого распределения.
\end{lem}

При больших $n$ применяется асимптотический подход.
\begin{namedthm}[Теорема Колмогорова]
Если гипотеза $H_0$ верна, и $F_{0}(x) \in C(\Real)$, то имеет место сходимость:
\begin{equation*}
    P\left\{\sqrt{n} D_{n}\left(\SampleX\right) \leqslant z\right\} \xrightarrow[n \to \infty]{} K(z)=1+2 \sum\limits_{m=1}^{\infty}(-1)^{m} e^{-2 m^{2} z^{2}}
\end{equation*}
\end{namedthm}

Находим константу $d_{1-\alpha}$ как решение уравнения $K\left(d_{1-\alpha}\right)=1-\alpha$.

Правило проверки гипотез:
\begin{compactlist}
    \item Если $\sqrt{n} D_{n}\left(\SampleX\right) \in\left(d_{1-\alpha}, \infty\right)$, то гипотеза $H_0$ отвергается;
    \item Если $\sqrt{n} D_{n}\left(\SampleX\right) \notin\left(d_{1-\alpha}, \infty\right)$, то гипотеза $H_0$ принимается.
\end{compactlist}

\begin{exmp}
Среди 100 студентов ВМК была проведена контрольная по ТВиМС.
\begin{center}
    \begin{tabular}{|l|l|l|l|l|l|}
    \hline Количество решённых задач & 1  & 2  & 3  & 4  & 5 \\
    \hline Частота                   & 18 & 16 & 26 & 22 & 18 \\
    \hline
\end{tabular}
\end{center}
На уровне значимости $\alpha=0{,}2$ с помощью критерия Колмогорова определить, 
подчиняются ли данные выборки на интервале $[0, 5]$ равномерному закону распределения случайной величины.

Запишем теоретическую функцию распределения:
\begin{equation*}
    F_{0}(x) = \begin{cases}
        0, & x<0 \\
        x/5, & 0 \leqslant x \leqslant 5 \\
        1, & x>5    
    \end{cases}
\end{equation*}

Составим следующую таблицу:
\begin{center}
    \begin{tabular}{|c|c|c|c|c|}
        \hline $x_{i}$ & $F(x_{i})$ & $n_{i}$ & $F^{*}_{n}(x_{i})$ & $|F_{0}(x_{i})-F^{*}_{n}(x_{i})|$ \\
        \hline 1 & 0{,}2 & 18 & 0{,}18 & 0{,}02 \\
        \hline 2 & 0{,}4 & 16 & 0{,}34 & 0{,}06 \\
        \hline 3 & 0{,}6 & 26 & 0{,}6  & 0    \\
        \hline 4 & 0{,}8 & 22 & 0{,}82 & 0{,}02 \\
        \hline 5 &   1 & 18 &    1 & 0    \\
        \hline
    \end{tabular}
\end{center}
Отсюда $D_{n}(x)=\sup\limits_{x \in R}\left|F_{n}^{*})-F_{0}(x)\right| = 0{,}06$, $\sqrt{n}D_{n}(x) = 0{,}6$, 
что меньше критического значения $0{,}65$ функции Колмогорова при уровне значимости $\alpha=0{,}2$, следовательно, гипотеза о равномерном распределении принимается.
\end{exmp}
